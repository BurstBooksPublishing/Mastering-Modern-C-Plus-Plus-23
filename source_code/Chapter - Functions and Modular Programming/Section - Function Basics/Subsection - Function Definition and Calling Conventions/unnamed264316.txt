#include <stdexcept>
#include <limits>

int multiply(int a, int b) {
    // Detect overflow before it happens
    if (a != 0 && (b > 0 ? (a > std::numeric_limits<int>::max() / b || a < std::numeric_limits<int>::min() / b)
                         : (a > std::numeric_limits<int>::min() / b || a < std::numeric_limits<int>::max() / b))) {
        throw std::overflow_error("Integer overflow in multiply");
    }
    return a * b;
}